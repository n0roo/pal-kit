<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAL Kit Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <h1>üöÄ PAL Kit Dashboard</h1>
            <div class="header-actions">
                <span id="last-update" class="muted">Loading...</span>
                <button id="refresh-btn" class="btn btn-secondary">‚Üª Refresh</button>
            </div>
        </header>

        <nav class="nav">
            <button class="nav-btn active" data-tab="status">Overview</button>
            <button class="nav-btn" data-tab="projects">Projects</button>
            <button class="nav-btn" data-tab="sessions">Sessions</button>
            <button class="nav-btn" data-tab="history">History</button>
            <button class="nav-btn" data-tab="ports">Ports</button>
            <button class="nav-btn" data-tab="workflows">Workflows</button>
            <button class="nav-btn" data-tab="docs">Documents</button>
            <button class="nav-btn" data-tab="conventions">Conventions</button>
            <button class="nav-btn" data-tab="agents">Agents</button>
        </nav>

        <main class="main">
            <!-- Status Tab -->
            <section id="tab-status" class="tab-content active">
                <h2>Overview</h2>

                <!-- Main Cards Row -->
                <div class="overview-grid">
                    <div class="stat-card clickable" onclick="showOverviewModal('active-sessions')">
                        <div class="stat-icon">üìç</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stat-sessions-active">-</div>
                            <div class="stat-label">Active Sessions</div>
                        </div>
                        <div class="stat-action">‚ñ∂</div>
                    </div>
                    <div class="stat-card clickable" onclick="showOverviewModal('completed-sessions')">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stat-sessions-completed">-</div>
                            <div class="stat-label">Completed Sessions</div>
                        </div>
                        <div class="stat-action">‚ñ∂</div>
                    </div>
                    <div class="stat-card clickable" onclick="showOverviewModal('ports')">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stat-ports-total">-</div>
                            <div class="stat-label">Ports</div>
                            <div class="stat-sub" id="stat-ports-breakdown">-</div>
                        </div>
                        <div class="stat-action">‚ñ∂</div>
                    </div>
                    <div class="stat-card clickable" onclick="showOverviewModal('workflows')">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stat-workflows-running">-</div>
                            <div class="stat-label">Workflows</div>
                        </div>
                        <div class="stat-action">‚ñ∂</div>
                    </div>
                </div>

                <!-- Metrics Row -->
                <h3 class="section-title">Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card clickable" onclick="showOverviewModal('tokens')">
                        <div class="metric-icon">üî¢</div>
                        <div class="metric-info">
                            <div class="metric-value" id="stat-total-tokens">-</div>
                            <div class="metric-label">Total Tokens</div>
                        </div>
                    </div>
                    <div class="metric-card highlight clickable" onclick="showOverviewModal('cost')">
                        <div class="metric-icon">üí∞</div>
                        <div class="metric-info">
                            <div class="metric-value" id="stat-total-cost">-</div>
                            <div class="metric-label">Total Cost</div>
                        </div>
                    </div>
                    <div class="metric-card clickable" onclick="showOverviewModal('time')">
                        <div class="metric-icon">‚è±Ô∏è</div>
                        <div class="metric-info">
                            <div class="metric-value" id="stat-total-duration">-</div>
                            <div class="metric-label">Total Time</div>
                        </div>
                    </div>
                    <div class="metric-card warning clickable" onclick="showOverviewModal('escalations')">
                        <div class="metric-icon">üö®</div>
                        <div class="metric-info">
                            <div class="metric-value" id="stat-escalations-open">-</div>
                            <div class="metric-label">Escalations</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Projects Tab -->
            <section id="tab-projects" class="tab-content">
                <div class="tab-header">
                    <h2>Projects</h2>
                    <div class="search-box">
                        <input type="text" id="projects-search" placeholder="Search projects..." oninput="filterProjects(this.value)">
                    </div>
                </div>
                <div class="cards-grid" id="projects-grid"></div>
            </section>

            <!-- Sessions Tab -->
            <section id="tab-sessions" class="tab-content">
                <h2>Sessions</h2>

                <!-- Session Tree View -->
                <div class="viz-section">
                    <h3 class="section-title">üìÇ Session Tree</h3>
                    <div id="session-tree" class="tree-view">
                        <div class="empty-state">Loading session tree...</div>
                    </div>
                </div>

                <!-- Session Table -->
                <h3 class="section-title">Session List</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Duration</th>
                                <th>Tokens</th>
                                <th>Cost</th>
                                <th>Children</th>
                            </tr>
                        </thead>
                        <tbody id="sessions-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- History Tab -->
            <section id="tab-history" class="tab-content">
                <div class="tab-header">
                    <h2>Event History</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportHistory('json')">Export JSON</button>
                        <button class="btn btn-secondary" onclick="exportHistory('csv')">Export CSV</button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-row">
                    <div class="filter-group">
                        <label>Event Type</label>
                        <select id="history-event-type" onchange="loadEventHistory()">
                            <option value="">All Types</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Project</label>
                        <select id="history-project" onchange="loadEventHistory()">
                            <option value="">All Projects</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Date Range</label>
                        <select id="history-date-range" onchange="loadEventHistory()">
                            <option value="today">Today</option>
                            <option value="7d" selected>Last 7 days</option>
                            <option value="30d">Last 30 days</option>
                            <option value="all">All time</option>
                        </select>
                    </div>
                    <div class="filter-group search">
                        <label>Search</label>
                        <input type="text" id="history-search" placeholder="Search events..." onkeyup="debounceHistorySearch(this.value)">
                    </div>
                </div>

                <!-- Stats -->
                <div class="history-stats">
                    <span id="history-total">0 events</span>
                    <span id="history-stats-detail"></span>
                </div>

                <!-- Events Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Time</th>
                                <th>Event Type</th>
                                <th>Session</th>
                                <th>Project</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="history-table"></tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="history-pagination">
                    <button class="btn btn-secondary" id="history-prev" onclick="historyPrevPage()" disabled>Previous</button>
                    <span id="history-page-info">Page 1</span>
                    <button class="btn btn-secondary" id="history-next" onclick="historyNextPage()">Next</button>
                </div>
            </section>

            <!-- Ports Tab -->
            <section id="tab-ports" class="tab-content">
                <h2>Ports</h2>

                <!-- Port Progress Dashboard -->
                <div class="viz-section">
                    <h3 class="section-title">üìä Port Progress</h3>
                    <div class="port-progress-grid">
                        <div class="progress-column">
                            <div class="progress-header complete">‚úÖ Completed</div>
                            <div id="ports-completed" class="progress-list"></div>
                        </div>
                        <div class="progress-column">
                            <div class="progress-header active">üîÑ In Progress</div>
                            <div id="ports-in-progress" class="progress-list"></div>
                        </div>
                        <div class="progress-column">
                            <div class="progress-header pending">‚è≥ Pending</div>
                            <div id="ports-pending" class="progress-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Port Flow Diagram -->
                <div class="viz-section">
                    <h3 class="section-title">üîó Port Dependencies</h3>
                    <div id="port-flow" class="flow-diagram">
                        <div class="empty-state">Loading port flow...</div>
                    </div>
                </div>

                <!-- Port Table -->
                <h3 class="section-title">Port List</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Session</th>
                                <th>Duration</th>
                                <th>Tokens</th>
                                <th>Cost</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="ports-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- Workflows Tab -->
            <section id="tab-workflows" class="tab-content">
                <h2>Workflows</h2>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="workflows-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- Documents Tab -->
            <section id="tab-docs" class="tab-content">
                <div class="tab-header">
                    <h2>Documents</h2>
                    <div class="search-box">
                        <input type="text" id="docs-search" placeholder="Search documents..." oninput="filterDocs(this.value)">
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Path</th>
                                <th>Type</th>
                                <th>Size</th>
                                <th>Modified</th>
                            </tr>
                        </thead>
                        <tbody id="docs-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- Conventions Tab -->
            <section id="tab-conventions" class="tab-content">
                <h2>Conventions</h2>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Rules</th>
                                <th>Priority</th>
                            </tr>
                        </thead>
                        <tbody id="conventions-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- Agents Tab -->
            <section id="tab-agents" class="tab-content">
                <h2>Agents</h2>
                <div class="cards-grid" id="agents-grid"></div>
            </section>
        </main>

        <footer class="footer">
            <span>PAL Kit v0.3.0</span>
            <span id="project-root" class="muted"></span>
        </footer>
    </div>

    <!-- Session Detail Modal -->
    <div id="session-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Session Detail</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="session-modal-body">
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div id="doc-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="doc-modal-title">Document</h3>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="copyDocument()" title="Copy to clipboard">Copy</button>
                    <button class="btn btn-secondary" onclick="downloadDocument()" title="Download file">Download</button>
                    <button class="modal-close">&times;</button>
                </div>
            </div>
            <div class="modal-body doc-viewer" id="doc-modal-body">
            </div>
        </div>
    </div>

    <!-- Project Detail Modal -->
    <div id="project-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="project-modal-title">Project Detail</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="project-modal-body">
            </div>
        </div>
    </div>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
